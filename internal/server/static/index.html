<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Eros - Hit Bot</title>
  <link rel="icon" href="/logo.png" type="image/png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: '#0a0a0b',
            'bg-card': '#111113',
            'bg-input': '#18181b',
            border: '#27272a',
            accent: '#dc2626',
            'accent-hover': '#ef4444',
            success: '#22c55e',
            error: '#ef4444',
          },
          fontFamily: {
            sans: ['Outfit', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          },
          animation: {
            'pulse-slow': 'pulse 2s infinite',
          }
        }
      }
    }
  </script>
  <style>
    body {
      background-image: radial-gradient(ellipse 80% 50% at 50% -20%, rgba(220,38,38,0.08), transparent);
    }
    .log-area::-webkit-scrollbar { width: 6px; }
    .log-area::-webkit-scrollbar-track { background: #18181b; border-radius: 3px; }
    .log-area::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
    .log-area::-webkit-scrollbar-thumb:hover { background: #52525b; }
    
    @keyframes fadeIn { 
      from { opacity: 0; transform: scale(0.95); } 
      to { opacity: 1; transform: scale(1); } 
    }
    .animate-fadeIn { animation: fadeIn 0.3s ease; }
  </style>
</head>
<body class="bg-bg text-white min-h-screen font-sans leading-relaxed">
  <!-- Language selection modal -->
  <div class="fixed inset-0 bg-black/85 flex items-center justify-center z-50 backdrop-blur-sm" id="langModal">
    <div class="bg-bg-card border border-border rounded-xl p-8 text-center max-w-md animate-fadeIn">
      <img src="/logo.png" alt="Eros - Hit Botu" class="w-20 h-20 rounded-xl mx-auto mb-6 border border-border object-cover">
      <h2 class="text-2xl font-bold mb-2" id="langModalTitle">Dil Seçin / Select Language</h2>
      <p class="text-zinc-400 mb-6 text-sm" id="langModalSub">Uygulama dilini seçin / Choose application language</p>
      <div class="flex justify-center gap-4 flex-wrap">
        <button class="px-8 py-3 bg-accent hover:bg-accent-hover text-white font-semibold rounded-xl transition-all duration-200 hover:-translate-y-0.5" id="btnLangTR">Türkçe</button>
        <button class="px-8 py-3 bg-bg-input hover:bg-border text-white font-semibold rounded-xl border border-border transition-all duration-200" id="btnLangEN">English</button>
      </div>
    </div>
  </div>

  <div class="hidden" id="mainApp">
    <div class="max-w-4xl mx-auto px-6 py-8">
      <!-- GitHub Link Bar -->
      <div class="flex items-center justify-between mb-4 text-sm">
        <a href="https://github.com/eros1sh/eros-hitbot" target="_blank" rel="noopener noreferrer"
           class="inline-flex items-center gap-2 text-zinc-400 hover:text-white transition-colors group">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
          <span class="group-hover:underline">eros1sh/eros-hitbot</span>
        </a>
        <span class="text-zinc-600 text-xs">v2.1.0</span>
      </div>
      
      <!-- Header -->
      <header class="flex items-center gap-5 mb-8 pb-6 border-b border-border">
        <img src="/logo.png" alt="Eros - Hit Botu" class="w-16 h-16 rounded-xl border border-border object-cover shadow-lg">
        <div class="flex-1">
          <div class="flex items-center gap-3 flex-wrap">
            <h1 class="text-2xl font-bold tracking-tight" id="brandTitle">Eros - Hit Botu</h1>
            <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium bg-zinc-800/50 text-zinc-400" id="statusBadge">
              <span class="w-1.5 h-1.5 rounded-full bg-current" id="statusDot"></span>
              <span id="statusText">—</span>
            </span>
          </div>
          <p class="text-zinc-400 text-sm mt-1" id="brandSubtitle">—</p>
        </div>
      </header>

      <!-- Test Parameters Card -->
      <div class="bg-bg-card border border-border rounded-xl p-6 mb-5 shadow-lg">
        <h2 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-5" id="cardParams">—</h2>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- Domain -->
          <div class="space-y-2">
            <label for="domain" class="block text-sm font-medium text-zinc-400" id="labelDomain">—</label>
            <input type="text" id="domain" placeholder="example.com" autocomplete="off"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
          </div>
          
          <!-- GTAG -->
          <div class="space-y-2">
            <label for="gtagId" class="block text-sm font-medium text-zinc-400" id="labelGtag">—</label>
            <input type="text" id="gtagId" placeholder="G-XXXXXXXXXXX" autocomplete="off"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
          </div>
          
          <!-- Max Pages -->
          <div class="space-y-2">
            <label for="maxPages" class="block text-sm font-medium text-zinc-400" id="labelMaxPages">—</label>
            <input type="number" id="maxPages" placeholder="5" min="1" max="100" value="5"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
          </div>
          
          <!-- Duration -->
          <div class="space-y-2">
            <label for="duration" class="block text-sm font-medium text-zinc-400" id="labelDuration">—</label>
            <input type="number" id="duration" placeholder="60" min="1" value="60"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
          </div>
          
          <!-- HPM -->
          <div class="space-y-2">
            <label for="hpm" class="block text-sm font-medium text-zinc-400" id="labelHpm">—</label>
            <input type="number" id="hpm" placeholder="35" min="1" max="120" value="35"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
          </div>
          
          <!-- Max Concurrent -->
          <div class="space-y-2">
            <label for="maxConcurrent" class="block text-sm font-medium text-zinc-400" id="labelMaxConcurrent">—</label>
            <input type="number" id="maxConcurrent" placeholder="10" min="1" max="50" value="10" title="Paralel tarayıcı sayısı"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
          </div>
          
          <!-- Output Dir -->
          <div class="space-y-2">
            <label for="outputDir" class="block text-sm font-medium text-zinc-400" id="labelOutputDir">—</label>
            <input type="text" id="outputDir" placeholder="./reports" autocomplete="off"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
          </div>
          
          <!-- Export Format -->
          <div class="space-y-2">
            <label for="exportFormat" class="block text-sm font-medium text-zinc-400" id="labelExportFormat">—</label>
            <select id="exportFormat"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors cursor-pointer">
              <option value="both" id="optExportBoth">CSV + JSON + HTML</option>
              <option value="csv" id="optExportCsv">CSV</option>
              <option value="json" id="optExportJson">JSON</option>
              <option value="html" id="optExportHtml">HTML</option>
            </select>
          </div>
          
          <!-- Scroll Strategy -->
          <div class="space-y-2">
            <label for="scrollStrategy" class="block text-sm font-medium text-zinc-400" id="labelScrollStrategy">—</label>
            <select id="scrollStrategy"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors cursor-pointer">
              <option value="gradual" id="optScrollGradual">Normal (Kademeli)</option>
              <option value="fast" id="optScrollFast">Hızlı</option>
              <option value="reader" id="optScrollReader">Okuyucu (Yavaş)</option>
            </select>
          </div>
          
          <!-- Keywords - Full Width -->
          <div class="space-y-2 sm:col-span-2 lg:col-span-3">
            <label for="keywords" class="block text-sm font-medium text-zinc-400" id="labelKeywords">—</label>
            <textarea id="keywords" rows="3" placeholder="target keyword, long tail keyword, brand name"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600 resize-y min-h-[70px]"></textarea>
          </div>
          
          <!-- Checkboxes Row -->
          <div class="flex items-center gap-2">
            <input type="checkbox" id="canvasFingerprint" class="w-4 h-4 rounded border-border bg-bg-input text-accent focus:ring-accent focus:ring-offset-0 cursor-pointer">
            <label for="canvasFingerprint" class="text-sm text-zinc-400 cursor-pointer" id="labelCanvasFp">—</label>
          </div>
          
          <div class="flex items-center gap-2">
            <input type="checkbox" id="sendScrollEvent" class="w-4 h-4 rounded border-border bg-bg-input text-accent focus:ring-accent focus:ring-offset-0 cursor-pointer">
            <label for="sendScrollEvent" class="text-sm text-zinc-400 cursor-pointer" id="labelScrollEvent">—</label>
          </div>
          
          <div class="flex items-center gap-2">
            <input type="checkbox" id="useSitemap" class="w-4 h-4 rounded border-border bg-bg-input text-accent focus:ring-accent focus:ring-offset-0 cursor-pointer">
            <label for="useSitemap" class="text-sm text-zinc-400 cursor-pointer" id="labelUseSitemap">—</label>
          </div>
          
          <!-- Sitemap Weight -->
          <div class="space-y-2">
            <label for="sitemapHomepageWeight" class="block text-sm font-medium text-zinc-400" id="labelSitemapHomepageWeight">—</label>
            <input type="number" id="sitemapHomepageWeight" placeholder="60" min="0" max="100" value="60" title="Anasayfaya gidecek istek yüzdesi"
              class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
          </div>
        </div>
        
        <!-- Proxy Settings - Collapsible Section -->
        <div class="mt-6 pt-5 border-t border-border/50">
          <h3 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-4" id="proxySettingsTitle">Proxy Ayarları</h3>
          
          <!-- Private Proxy -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-5">
            <div class="space-y-2">
              <label for="proxyHost" class="block text-sm font-medium text-zinc-400" id="labelProxyHost">—</label>
              <input type="text" id="proxyHost" placeholder="proxy.example.com" autocomplete="off"
                class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
            </div>
            
            <div class="space-y-2">
              <label for="proxyPort" class="block text-sm font-medium text-zinc-400" id="labelProxyPort">—</label>
              <input type="number" id="proxyPort" placeholder="3120" min="1" max="65535" autocomplete="off"
                class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
            </div>
            
            <div class="space-y-2">
              <label for="proxyUser" class="block text-sm font-medium text-zinc-400" id="labelProxyUser">—</label>
              <input type="text" id="proxyUser" placeholder="" autocomplete="off"
                class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
            </div>
            
            <div class="space-y-2">
              <label for="proxyPass" class="block text-sm font-medium text-zinc-400" id="labelProxyPass">—</label>
              <input type="password" id="proxyPass" placeholder="" autocomplete="off"
                class="w-full bg-bg-input border border-border rounded-lg px-4 py-2.5 text-white font-mono text-sm focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/50 transition-colors placeholder:text-zinc-600">
            </div>
          </div>
          
          <!-- Public Proxy Section -->
          <div class="bg-bg-input/50 rounded-lg p-4 border border-border/50">
            <div class="flex flex-wrap items-center gap-4 mb-3">
              <div class="flex items-center gap-2">
                <input type="checkbox" id="usePublicProxy" class="w-4 h-4 rounded border-border bg-bg-input text-accent focus:ring-accent focus:ring-offset-0 cursor-pointer">
                <label for="usePublicProxy" class="text-sm font-medium text-zinc-300 cursor-pointer" id="labelUsePublicProxy">—</label>
              </div>
              
              <div class="flex items-center gap-2">
                <label for="checkerWorkers" class="text-sm text-zinc-400" id="labelCheckerWorkers">—</label>
                <input type="number" id="checkerWorkers" placeholder="25" min="1" max="100" value="25" title="Aynı anda test edilen proxy sayısı"
                  class="w-16 bg-bg-input border border-border rounded-lg px-2 py-1.5 text-white font-mono text-sm focus:outline-none focus:border-accent transition-colors text-center">
              </div>
              
              <button class="px-4 py-1.5 bg-bg-input hover:bg-border text-white font-medium rounded-lg border border-border transition-all duration-200 text-sm" id="btnProxyFetch" type="button">—</button>
            </div>
            
            <p class="text-xs text-zinc-500" id="publicProxyDesc">Açık proxy listelerinden otomatik çeker ve test eder</p>
          </div>
        </div>
        
        <!-- Actions -->
        <div class="flex items-center gap-3 mt-6 pt-5 border-t border-border/50 flex-wrap">
          <button class="px-6 py-2.5 bg-accent hover:bg-accent-hover text-white font-semibold rounded-lg transition-all duration-200 hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none shadow-lg shadow-accent/20" id="btnStart">—</button>
          <button class="px-6 py-2.5 bg-bg-input hover:bg-border text-white font-semibold rounded-lg border border-border transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed" id="btnStop" disabled>—</button>
          
          <div class="ml-auto flex gap-1">
            <button class="px-3 py-1.5 text-xs font-medium rounded-md bg-bg-input border border-border text-zinc-400 hover:border-accent hover:text-accent transition-colors" id="btnLangTRSmall" data-lang="tr">TR</button>
            <button class="px-3 py-1.5 text-xs font-medium rounded-md bg-bg-input border border-border text-zinc-400 hover:border-accent hover:text-accent transition-colors" id="btnLangENSmall" data-lang="en">EN</button>
          </div>
        </div>
      </div>

      <!-- Metrics Card -->
      <div class="bg-bg-card border border-border rounded-xl p-6 mb-5 shadow-lg">
        <h2 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-5" id="cardMetrics">—</h2>
        
        <div class="grid grid-cols-2 sm:grid-cols-5 gap-4">
          <div class="bg-bg-input rounded-lg p-4 text-center">
            <div class="text-2xl font-bold font-mono text-accent" id="metricTotal">0</div>
            <div class="text-xs text-zinc-500 mt-1" id="metricLabelTotal">—</div>
          </div>
          
          <div class="bg-bg-input rounded-lg p-4 text-center">
            <div class="text-2xl font-bold font-mono text-success" id="metricSuccess">0</div>
            <div class="text-xs text-zinc-500 mt-1" id="metricLabelSuccess">—</div>
          </div>
          
          <div class="bg-bg-input rounded-lg p-4 text-center">
            <div class="text-2xl font-bold font-mono text-error" id="metricFailed">0</div>
            <div class="text-xs text-zinc-500 mt-1" id="metricLabelFailed">—</div>
          </div>
          
          <div class="bg-bg-input rounded-lg p-4 text-center">
            <div class="text-2xl font-bold font-mono text-blue-400" id="metricAvg">0 ms</div>
            <div class="text-xs text-zinc-500 mt-1" id="metricLabelAvg">—</div>
          </div>
          
          <div class="bg-bg-input rounded-lg p-4 text-center border border-purple-500/30">
            <div class="text-2xl font-bold font-mono text-purple-400" id="metricLiveProxy">0</div>
            <div class="text-xs text-zinc-500 mt-1" id="metricLabelLiveProxy">—</div>
          </div>
        </div>
      </div>

      <!-- Log Card -->
      <div class="bg-bg-card border border-border rounded-xl p-6 shadow-lg">
        <h2 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-4" id="cardLog">—</h2>
        <div class="log-area bg-[#080809] border border-border rounded-lg p-4 font-mono text-xs h-72 overflow-y-auto text-zinc-500 leading-relaxed" id="logArea"></div>
      </div>
    </div>
  </div>

  <script>
    const LANG_KEY = 'eroshit_lang';

    const t = {
      tr: {
        titleApp: 'Eros - Hit Botu',
        altLogo: 'Eros - Hit Botu',
        brandTitle: 'Eros - Hit Botu',
        langSelectTitle: 'Dil Seçin / Select Language',
        langSelectSub: 'Uygulama dilini seçin / Choose application language',
        btnLangTR: 'Türkçe',
        btnLangEN: 'English',
        brandSubtitle: 'Web Trafik Simülasyon Botu',
        statusWaiting: 'Beklemede',
        statusRunning: 'Çalışıyor',
        statusIdle: '—',
        cardParams: 'Test Parametreleri',
        labelDomain: 'Hedef Domain',
        placeholderDomain: 'example.com',
        labelGtag: 'GA4 / GTAG Kodu',
        placeholderGtag: 'G-XXXXXXXXXXX',
        labelMaxPages: 'Max Sayfa',
        placeholderMaxPages: '5',
        labelDuration: 'Süre (dakika)',
        placeholderDuration: '60',
        labelHpm: 'İstek / Dakika',
        placeholderHpm: '35',
        labelMaxConcurrent: 'Paralel Tarayıcı',
        placeholderMaxConcurrent: '10',
        titleMaxConcurrent: 'Paralel tarayıcı sayısı',
        labelOutputDir: 'Rapor Klasörü',
        placeholderOutputDir: './reports',
        labelExportFormat: 'Rapor Formatı',
        labelScrollStrategy: 'Scroll Stili',
        labelKeywords: 'Anahtar Kelimeler (virgül veya satır ile ayırın)',
        placeholderKeywords: 'anahtar kelime, uzun kuyruk, marka adı',
        labelCanvasFp: 'Canvas Fingerprint',
        labelScrollEvent: 'Scroll Event (GA4)',
        labelUseSitemap: 'Sitemap.xml kullan',
        labelSitemapHomepageWeight: 'Anasayfa ağırlığı (%)',
        placeholderSitemapWeight: '60',
        titleSitemapWeight: 'Anasayfaya gidecek istek yüzdesi',
        labelProxyHost: 'Proxy Host',
        placeholderProxyHost: 'proxy.example.com',
        labelProxyPort: 'Proxy Port',
        placeholderProxyPort: '3120',
        labelProxyUser: 'Proxy Kullanıcı',
        labelProxyPass: 'Proxy Şifre',
        btnStart: 'Başlat',
        btnStop: 'Durdur',
        cardMetrics: 'Canlı Metrikler',
        metricTotal: 'Toplam İstek',
        metricSuccess: 'Başarılı',
        metricFailed: 'Hatalı',
        metricAvg: 'Ort. Yanıt',
        metricLiveProxy: 'Canlı Proxy',
        proxySettingsTitle: 'Proxy Ayarları',
        publicProxyDesc: 'Açık proxy listelerinden otomatik çeker ve test eder',
        cardLog: 'Log',
        errorDomain: 'Hata: Hedef domain girin.',
        errorStart: 'Başlatma hatası',
        errorStop: 'Durdurma hatası',
        logStarted: 'Simülasyon başlatıldı.',
        logStopped: 'Simülasyon durduruldu.',
        logConfigError: 'Config yüklenemedi',
        optExportBoth: 'CSV + JSON + HTML',
        optExportCsv: 'CSV',
        optExportJson: 'JSON',
        optExportHtml: 'HTML',
        optScrollGradual: 'Normal (Kademeli)',
        optScrollFast: 'Hızlı',
        optScrollReader: 'Okuyucu (Yavaş)',
        cardPublicProxy: 'Public Proxy (Dahili Bulucu)',
        labelUsePublicProxy: 'Public proxy kullan',
        labelCheckerWorkers: 'Checker Workers',
        placeholderCheckerWorkers: '25',
        titleCheckerWorkers: 'Aynı anda test edilen proxy sayısı',
        btnProxyFetch: 'Proxy Çek & Test Et',
        unitMs: ' ms',
        logProxyFetchStarted: 'Proxy çekme başlatıldı.',
        logProxyFetchError: 'Proxy çekme hatası: ',
        logGitHubAdded: 'Havuza {{n}} proxy eklendi.',
        proxyChecking: 'Test ediliyor...',
        proxyCheckComplete: 'Proxy testi tamamlandı.',
      },
      en: {
        titleApp: 'Eros - Hit Bot',
        altLogo: 'Eros - Hit Bot',
        brandTitle: 'Eros - Hit Bot',
        langSelectTitle: 'Select Language',
        langSelectSub: 'Choose application language',
        btnLangTR: 'Türkçe',
        btnLangEN: 'English',
        brandSubtitle: 'Web Traffic Simulation Bot',
        statusWaiting: 'Waiting',
        statusRunning: 'Running',
        statusIdle: '—',
        cardParams: 'Test Parameters',
        labelDomain: 'Target Domain',
        placeholderDomain: 'example.com',
        labelGtag: 'GA4 / GTAG Code',
        placeholderGtag: 'G-XXXXXXXXXXX',
        labelMaxPages: 'Max Pages',
        placeholderMaxPages: '5',
        labelDuration: 'Duration (minutes)',
        placeholderDuration: '60',
        labelHpm: 'Requests / Minute',
        placeholderHpm: '35',
        labelMaxConcurrent: 'Parallel Browsers',
        placeholderMaxConcurrent: '10',
        titleMaxConcurrent: 'Number of parallel browsers',
        labelOutputDir: 'Report Folder',
        placeholderOutputDir: './reports',
        labelExportFormat: 'Report Format',
        labelScrollStrategy: 'Scroll Style',
        labelKeywords: 'Keywords (comma or newline separated)',
        placeholderKeywords: 'keyword, long tail, brand name',
        labelCanvasFp: 'Canvas Fingerprint',
        labelScrollEvent: 'Scroll Event (GA4)',
        labelUseSitemap: 'Use sitemap.xml',
        labelSitemapHomepageWeight: 'Homepage weight (%)',
        placeholderSitemapWeight: '60',
        titleSitemapWeight: 'Percentage of requests to homepage',
        labelProxyHost: 'Proxy Host',
        placeholderProxyHost: 'proxy.example.com',
        labelProxyPort: 'Proxy Port',
        placeholderProxyPort: '3120',
        labelProxyUser: 'Proxy User',
        labelProxyPass: 'Proxy Password',
        btnStart: 'Start',
        btnStop: 'Stop',
        cardMetrics: 'Live Metrics',
        metricTotal: 'Total Requests',
        metricSuccess: 'Successful',
        metricFailed: 'Failed',
        metricAvg: 'Avg Response',
        metricLiveProxy: 'Live Proxy',
        proxySettingsTitle: 'Proxy Settings',
        publicProxyDesc: 'Automatically fetches and tests from public proxy lists',
        cardLog: 'Log',
        errorDomain: 'Error: Enter target domain.',
        errorStart: 'Start error',
        errorStop: 'Stop error',
        logStarted: 'Simulation started.',
        logStopped: 'Simulation stopped.',
        logConfigError: 'Failed to load config',
        optExportBoth: 'CSV + JSON + HTML',
        optExportCsv: 'CSV',
        optExportJson: 'JSON',
        optExportHtml: 'HTML',
        optScrollGradual: 'Normal (Gradual)',
        optScrollFast: 'Fast',
        optScrollReader: 'Reader (Slow)',
        cardPublicProxy: 'Public Proxy (Built-in Finder)',
        labelUsePublicProxy: 'Use public proxy',
        labelCheckerWorkers: 'Checker Workers',
        placeholderCheckerWorkers: '25',
        titleCheckerWorkers: 'Number of proxies tested at once',
        btnProxyFetch: 'Fetch & Test Proxies',
        unitMs: ' ms',
        logProxyFetchStarted: 'Proxy fetch started.',
        logProxyFetchError: 'Proxy fetch error: ',
        logGitHubAdded: 'Added {{n}} proxies.',
        proxyChecking: 'Testing...',
        proxyCheckComplete: 'Proxy test completed.',
      }
    };

    let lang = localStorage.getItem(LANG_KEY) || '';
    let statusInterval = null;
    let eventSource = null;
    let wsConn = null;

    const langModal = document.getElementById('langModal');
    const mainApp = document.getElementById('mainApp');

    function showLangModal() {
      langModal.style.display = 'flex';
      mainApp.classList.add('hidden');
      mainApp.classList.remove('block');
    }

    function hideLangModal() {
      langModal.style.display = 'none';
      mainApp.classList.remove('hidden');
      mainApp.classList.add('block');
    }

    function setLang(newLang) {
      lang = newLang;
      localStorage.setItem(LANG_KEY, lang);
      applyTranslations();
      hideLangModal();
      updateLangButtons();
    }

    function applyTranslations() {
      const L = t[lang] || t.tr;
      document.getElementById('brandSubtitle').textContent = L.brandSubtitle;
      document.getElementById('statusText').textContent = L.statusWaiting;
      document.getElementById('cardParams').textContent = L.cardParams;
      document.getElementById('labelDomain').textContent = L.labelDomain;
      document.getElementById('labelMaxPages').textContent = L.labelMaxPages;
      document.getElementById('labelDuration').textContent = L.labelDuration;
      document.getElementById('labelHpm').textContent = L.labelHpm;
      document.getElementById('labelProxyHost').textContent = L.labelProxyHost;
      document.getElementById('labelProxyPort').textContent = L.labelProxyPort;
      document.getElementById('labelProxyUser').textContent = L.labelProxyUser;
      document.getElementById('labelProxyPass').textContent = L.labelProxyPass;
      document.getElementById('labelGtag').textContent = L.labelGtag;
      document.getElementById('labelMaxConcurrent').textContent = L.labelMaxConcurrent;
      document.getElementById('labelOutputDir').textContent = L.labelOutputDir;
      document.getElementById('labelExportFormat').textContent = L.labelExportFormat;
      document.getElementById('labelScrollStrategy').textContent = L.labelScrollStrategy;
      document.getElementById('labelKeywords').textContent = L.labelKeywords;
      document.getElementById('labelCanvasFp').textContent = L.labelCanvasFp;
      document.getElementById('labelScrollEvent').textContent = L.labelScrollEvent;
      document.getElementById('labelUseSitemap').textContent = L.labelUseSitemap;
      document.getElementById('labelSitemapHomepageWeight').textContent = L.labelSitemapHomepageWeight;
      document.getElementById('btnStart').textContent = L.btnStart;
      document.getElementById('btnStop').textContent = L.btnStop;
      document.getElementById('cardMetrics').textContent = L.cardMetrics;
      document.getElementById('metricLabelTotal').textContent = L.metricTotal;
      document.getElementById('metricLabelSuccess').textContent = L.metricSuccess;
      document.getElementById('metricLabelFailed').textContent = L.metricFailed;
      document.getElementById('metricLabelAvg').textContent = L.metricAvg;
      document.getElementById('metricLabelLiveProxy').textContent = L.metricLiveProxy;
      document.getElementById('cardLog').textContent = L.cardLog;
      document.getElementById('proxySettingsTitle').textContent = L.proxySettingsTitle;
      document.getElementById('labelUsePublicProxy').textContent = L.labelUsePublicProxy;
      document.getElementById('labelCheckerWorkers').textContent = L.labelCheckerWorkers;
      document.getElementById('btnProxyFetch').textContent = L.btnProxyFetch;
      document.getElementById('publicProxyDesc').textContent = L.publicProxyDesc;
      document.querySelector('title').textContent = L.titleApp;
      document.documentElement.lang = lang === 'en' ? 'en' : 'tr';
      document.getElementById('langModalTitle').textContent = L.langSelectTitle;
      document.getElementById('langModalSub').textContent = L.langSelectSub;
      document.getElementById('btnLangTR').textContent = L.btnLangTR;
      document.getElementById('btnLangEN').textContent = L.btnLangEN;
      document.getElementById('brandTitle').textContent = L.brandTitle;
      document.querySelectorAll('img[alt]').forEach(img => img.alt = L.altLogo || '');
      
      // Placeholders
      document.getElementById('domain').placeholder = L.placeholderDomain || '';
      document.getElementById('gtagId').placeholder = L.placeholderGtag || '';
      document.getElementById('maxPages').placeholder = L.placeholderMaxPages || '';
      document.getElementById('duration').placeholder = L.placeholderDuration || '';
      document.getElementById('hpm').placeholder = L.placeholderHpm || '';
      document.getElementById('maxConcurrent').placeholder = L.placeholderMaxConcurrent || '';
      document.getElementById('maxConcurrent').title = L.titleMaxConcurrent || '';
      document.getElementById('outputDir').placeholder = L.placeholderOutputDir || '';
      document.getElementById('keywords').placeholder = L.placeholderKeywords || '';
      document.getElementById('sitemapHomepageWeight').placeholder = L.placeholderSitemapWeight || '';
      document.getElementById('sitemapHomepageWeight').title = L.titleSitemapWeight || '';
      document.getElementById('proxyHost').placeholder = L.placeholderProxyHost || '';
      document.getElementById('proxyPort').placeholder = L.placeholderProxyPort || '';
      document.getElementById('checkerWorkers').placeholder = L.placeholderCheckerWorkers || '';
      document.getElementById('checkerWorkers').title = L.titleCheckerWorkers || '';
      
      // Select options
      document.getElementById('optExportBoth').textContent = L.optExportBoth;
      document.getElementById('optExportCsv').textContent = L.optExportCsv;
      document.getElementById('optExportJson').textContent = L.optExportJson;
      document.getElementById('optExportHtml').textContent = L.optExportHtml;
      document.getElementById('optScrollGradual').textContent = L.optScrollGradual;
      document.getElementById('optScrollFast').textContent = L.optScrollFast;
      document.getElementById('optScrollReader').textContent = L.optScrollReader;
    }

    document.getElementById('btnLangTR').addEventListener('click', () => setLang('tr'));
    document.getElementById('btnLangEN').addEventListener('click', () => setLang('en'));
    document.getElementById('btnLangTRSmall').addEventListener('click', () => setLang('tr'));
    document.getElementById('btnLangENSmall').addEventListener('click', () => setLang('en'));

    function updateLangButtons() {
      const trBtn = document.getElementById('btnLangTRSmall');
      const enBtn = document.getElementById('btnLangENSmall');
      trBtn.classList.toggle('border-accent', lang === 'tr');
      trBtn.classList.toggle('text-accent', lang === 'tr');
      enBtn.classList.toggle('border-accent', lang === 'en');
      enBtn.classList.toggle('text-accent', lang === 'en');
    }

    // URL'den ?lang= parametresi
    const urlParams = new URLSearchParams(window.location.search);
    const urlLang = urlParams.get('lang');
    if (urlLang === 'tr' || urlLang === 'en') {
      lang = urlLang;
      localStorage.setItem(LANG_KEY, lang);
      applyTranslations();
      hideLangModal();
      updateLangButtons();
    } else if (!lang) {
      const detected = (navigator.language && navigator.language.startsWith('en')) ? 'en' : 'tr';
      const L0 = t[detected];
      document.getElementById('langModalTitle').textContent = L0.langSelectTitle;
      document.getElementById('langModalSub').textContent = L0.langSelectSub;
      document.getElementById('btnLangTR').textContent = L0.btnLangTR;
      document.getElementById('btnLangEN').textContent = L0.btnLangEN;
      showLangModal();
    } else {
      applyTranslations();
      hideLangModal();
      updateLangButtons();
    }

    // Form elements
    const domain = document.getElementById('domain');
    const maxPages = document.getElementById('maxPages');
    const duration = document.getElementById('duration');
    const hpm = document.getElementById('hpm');
    const gtagId = document.getElementById('gtagId');
    const proxyHost = document.getElementById('proxyHost');
    const proxyPort = document.getElementById('proxyPort');
    const proxyUser = document.getElementById('proxyUser');
    const proxyPass = document.getElementById('proxyPass');
    const maxConcurrent = document.getElementById('maxConcurrent');
    const outputDir = document.getElementById('outputDir');
    const exportFormat = document.getElementById('exportFormat');
    const scrollStrategy = document.getElementById('scrollStrategy');
    const keywords = document.getElementById('keywords');
    const canvasFingerprint = document.getElementById('canvasFingerprint');
    const sendScrollEvent = document.getElementById('sendScrollEvent');
    const useSitemap = document.getElementById('useSitemap');
    const sitemapHomepageWeight = document.getElementById('sitemapHomepageWeight');
    const usePublicProxy = document.getElementById('usePublicProxy');
    const checkerWorkers = document.getElementById('checkerWorkers');

    const STORAGE_KEY = 'eroshit_form';
    const btnStart = document.getElementById('btnStart');
    const btnStop = document.getElementById('btnStop');
    const statusBadge = document.getElementById('statusBadge');
    const statusText = document.getElementById('statusText');
    const statusDot = document.getElementById('statusDot');
    const logArea = document.getElementById('logArea');
    const metricTotal = document.getElementById('metricTotal');
    const metricSuccess = document.getElementById('metricSuccess');
    const metricFailed = document.getElementById('metricFailed');
    const metricAvg = document.getElementById('metricAvg');

    function L() { return t[lang] || t.tr; }

    function parseKeywords(s) {
      if (!s || typeof s !== 'string') return [];
      return s.split(/[\n,;]+/).map(k => k.trim()).filter(k => k);
    }

    function loadFromStorage() {
      try {
        const s = localStorage.getItem(STORAGE_KEY);
        if (s) {
          const c = JSON.parse(s);
          domain.value = c.domain ?? 'example.com';
          gtagId.value = c.gtag_id ?? '';
          maxPages.value = c.max_pages ?? 5;
          duration.value = c.duration_minutes ?? 60;
          hpm.value = c.hits_per_minute ?? 35;
          maxConcurrent.value = c.max_concurrent_visits ?? 10;
          outputDir.value = c.output_dir ?? './reports';
          exportFormat.value = c.export_format ?? 'both';
          scrollStrategy.value = c.scroll_strategy ?? 'gradual';
          keywords.value = Array.isArray(c.keywords) ? c.keywords.join('\n') : (c.keywords_str || '');
          canvasFingerprint.checked = !!c.canvas_fingerprint;
          sendScrollEvent.checked = !!c.send_scroll_event;
          useSitemap.checked = !!c.use_sitemap;
          sitemapHomepageWeight.value = (c.sitemap_homepage_weight ?? 60).toString();
          proxyHost.value = c.proxy_host ?? '';
          proxyPort.value = c.proxy_port ?? '';
          proxyUser.value = c.proxy_user ?? '';
          proxyPass.value = c.proxy_pass ?? '';
          usePublicProxy.checked = !!c.use_public_proxy;
          checkerWorkers.value = (c.checker_workers ?? 25).toString();
          return true;
        }
      } catch (_) {}
      return false;
    }

    function saveToStorage() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({
          domain: domain.value.trim(),
          gtag_id: gtagId.value.trim(),
          max_pages: parseInt(maxPages.value) || 5,
          duration_minutes: parseInt(duration.value) || 60,
          hits_per_minute: parseInt(hpm.value) || 35,
          max_concurrent_visits: parseInt(maxConcurrent.value) || 10,
          output_dir: outputDir.value.trim() || './reports',
          export_format: exportFormat.value || 'both',
          scroll_strategy: scrollStrategy.value || 'gradual',
          keywords: parseKeywords(keywords.value),
          canvas_fingerprint: canvasFingerprint.checked,
          send_scroll_event: sendScrollEvent.checked,
          use_sitemap: useSitemap.checked,
          sitemap_homepage_weight: parseInt(sitemapHomepageWeight.value) || 60,
          proxy_host: proxyHost.value.trim(),
          proxy_port: parseInt(proxyPort.value) || 0,
          proxy_user: proxyUser.value.trim(),
          proxy_pass: proxyPass.value,
          use_public_proxy: usePublicProxy.checked,
          checker_workers: parseInt(checkerWorkers.value) || 25
        }));
      } catch (_) {}
    }

    async function loadConfig() {
      if (loadFromStorage()) return;
      try {
        const r = await fetch('/api/config');
        const c = await r.json();
        domain.value = c.target_domain || 'example.com';
        gtagId.value = c.gtag_id || '';
        maxPages.value = c.max_pages || 5;
        duration.value = c.duration_minutes || 60;
        hpm.value = c.hits_per_minute || 35;
        maxConcurrent.value = c.max_concurrent_visits || 10;
        outputDir.value = c.output_dir || './reports';
        exportFormat.value = c.export_format || 'both';
        scrollStrategy.value = c.scroll_strategy || 'gradual';
        keywords.value = Array.isArray(c.keywords) ? c.keywords.join('\n') : '';
        canvasFingerprint.checked = !!c.canvas_fingerprint;
        sendScrollEvent.checked = !!c.send_scroll_event;
        useSitemap.checked = !!c.use_sitemap;
        sitemapHomepageWeight.value = String(c.sitemap_homepage_weight ?? 60);
        proxyHost.value = c.proxy_host || '';
        proxyPort.value = c.proxy_port || '';
        proxyUser.value = c.proxy_user || '';
        proxyPass.value = c.proxy_pass || '';
        usePublicProxy.checked = !!c.use_public_proxy;
        checkerWorkers.value = String(c.checker_workers ?? 25);
      } catch (e) {
        log(L().logConfigError + ': ' + e.message);
        domain.value = 'example.com';
      }
    }

    async function saveConfig() {
      saveToStorage();
      await fetch('/api/config', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          target_domain: domain.value.trim(),
          gtag_id: gtagId.value.trim(),
          max_pages: parseInt(maxPages.value) || 5,
          duration_minutes: parseInt(duration.value) || 60,
          hits_per_minute: parseInt(hpm.value) || 35,
          max_concurrent_visits: parseInt(maxConcurrent.value) || 10,
          output_dir: outputDir.value.trim() || './reports',
          export_format: exportFormat.value || 'both',
          scroll_strategy: scrollStrategy.value || 'gradual',
          keywords: parseKeywords(keywords.value),
          canvas_fingerprint: canvasFingerprint.checked,
          send_scroll_event: sendScrollEvent.checked,
          use_sitemap: useSitemap.checked,
          sitemap_homepage_weight: parseInt(sitemapHomepageWeight.value) || 60,
          proxy_host: proxyHost.value.trim(),
          proxy_port: parseInt(proxyPort.value) || 0,
          proxy_user: proxyUser.value.trim(),
          proxy_pass: proxyPass.value,
          use_public_proxy: usePublicProxy.checked,
          checker_workers: parseInt(checkerWorkers.value) || 25
        })
      });
    }

    function log(msg) {
      const line = document.createElement('div');
      line.className = 'whitespace-pre-wrap break-all';
      const locale = lang === 'en' ? 'en-US' : 'tr-TR';
      line.textContent = '[' + new Date().toLocaleTimeString(locale) + '] ' + msg;
      logArea.appendChild(line);
      logArea.scrollTop = logArea.scrollHeight;
    }

    async function start() {
      await saveConfig();
      if (!domain.value.trim()) {
        log(L().errorDomain);
        return;
      }
      try {
        const r = await fetch('/api/start', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ lang: lang || 'tr' })
        });
        const text = await r.text();
        const data = (() => { try { return JSON.parse(text); } catch (_) { return {}; } })();
        if (!r.ok) throw new Error(data.error || data.message || text || r.statusText);
        setRunning(true);
        log(L().logStarted);
        connectWebSocket();
        if (!wsConn) connectLogs();
        pollStatus();
      } catch (e) {
        log(L().errorStart + ': ' + (e.message || e));
      }
    }

    async function stop() {
      try {
        await fetch('/api/stop', { method: 'POST' });
        setRunning(false);
        if (eventSource) eventSource.close();
        if (wsConn) { try { wsConn.close(); } catch (_) {} wsConn = null; }
        if (statusInterval) clearInterval(statusInterval);
        log(L().logStopped);
      } catch (e) {
        log(L().errorStop + ': ' + e.message);
      }
    }

    function setRunning(running) {
      btnStart.disabled = running;
      btnStop.disabled = !running;
      if (running) {
        statusBadge.classList.remove('bg-zinc-800/50', 'text-zinc-400');
        statusBadge.classList.add('bg-success/15', 'text-success');
        statusDot.classList.add('animate-pulse');
      } else {
        statusBadge.classList.add('bg-zinc-800/50', 'text-zinc-400');
        statusBadge.classList.remove('bg-success/15', 'text-success');
        statusDot.classList.remove('animate-pulse');
      }
      statusText.textContent = running ? L().statusRunning : L().statusWaiting;
    }

    function connectLogs() {
      if (eventSource) eventSource.close();
      eventSource = new EventSource('/api/logs');
      eventSource.onmessage = (e) => {
        try {
          const msg = JSON.parse(e.data);
          log(msg);
        } catch (_) {
          log(e.data);
        }
      };
      eventSource.onerror = () => { eventSource.close(); };
    }

    function applyStatusData(s) {
      metricTotal.textContent = s.total_hits ?? 0;
      metricSuccess.textContent = s.success_hits ?? 0;
      metricFailed.textContent = s.failed_hits ?? 0;
      metricAvg.textContent = (s.avg_response_ms ?? 0).toFixed(0) + (L().unitMs || ' ms');
      
      // Proxy status güncelle
      if (s.proxy_status) {
        document.getElementById('metricLiveProxy').textContent = s.proxy_status.live_count ?? 0;
      }
      
      if (!s.running && btnStart.disabled) setRunning(false);
    }

    function connectWebSocket() {
      if (wsConn) return;
      const wsUrl = (window.location.protocol === 'https:' ? 'wss:' : 'ws:') + '//' + window.location.host + '/api/ws';
      try {
        const ws = new WebSocket(wsUrl);
        ws.onopen = function() {
          wsConn = ws;
          if (statusInterval) { clearInterval(statusInterval); statusInterval = null; }
          if (eventSource) { eventSource.close(); eventSource = null; }
        };
        ws.onmessage = function(ev) {
          try {
            const msg = JSON.parse(ev.data);
            if (msg.type === 'status' && msg.data) applyStatusData(msg.data);
            else if (msg.type === 'log') log(typeof msg.data === 'string' ? msg.data : (msg.data != null ? String(msg.data) : ''));
          } catch (_) {}
        };
        ws.onclose = ws.onerror = function() {
          wsConn = null;
          if (btnStart.disabled) connectLogs();
          if (btnStart.disabled && !statusInterval) pollStatus();
        };
      } catch (_) {}
    }

    async function pollStatus() {
      const update = async () => {
        try {
          const r = await fetch('/api/status');
          const s = await r.json();
          applyStatusData(s);
        } catch (_) {}
      };
      if (!wsConn) {
        statusInterval = setInterval(update, 2000);
        await update();
      }
    }

    let proxyPollInterval = null;
    
    async function proxyFetch() {
      const btn = document.getElementById('btnProxyFetch');
      const originalText = btn.textContent;
      const workers = parseInt(checkerWorkers.value) || 25;
      
      // Loading state başlat
      btn.disabled = true;
      btn.innerHTML = '<span class="inline-flex items-center gap-2"><svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>' + (L().proxyChecking || 'Çekiliyor...') + '</span></span>';
      
      try {
        const body = { checker_workers: workers };
        const r = await fetch('/api/proxy/fetch', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        let data = {};
        try { data = await r.json(); } catch (_) {}
        if (!r.ok) {
          log(L().logProxyFetchError + (data.error || data.message || r.statusText || ''));
          btn.disabled = false;
          btn.textContent = originalText;
          return;
        }
        if (data.added !== undefined) {
          log((L().logGitHubAdded || '').replace('{{n}}', data.added));
          btn.disabled = false;
          btn.textContent = originalText;
          return;
        }
        if (data.status === 'error') {
          log(L().logProxyFetchError + (data.error || ''));
          btn.disabled = false;
          btn.textContent = originalText;
          return;
        }
        log(L().logProxyFetchStarted);
        
        // Proxy status polling başlat
        startProxyStatusPolling(btn, originalText);
        
      } catch (e) {
        log(L().logProxyFetchError + (e.message || e));
        btn.disabled = false;
        btn.textContent = originalText;
      }
    }
    
    function startProxyStatusPolling(btn, originalText) {
      if (proxyPollInterval) clearInterval(proxyPollInterval);
      
      proxyPollInterval = setInterval(async () => {
        try {
          const r = await fetch('/api/proxy/status');
          const status = await r.json();
          
          // Live proxy sayısını güncelle
          document.getElementById('metricLiveProxy').textContent = status.live_count ?? 0;
          
          // Checking bittiğinde butonu eski haline döndür
          if (!status.checking) {
            clearInterval(proxyPollInterval);
            proxyPollInterval = null;
            btn.disabled = false;
            btn.textContent = originalText;
            log((L().proxyCheckComplete || 'Proxy testi tamamlandı.') + ' Canlı: ' + (status.live_count ?? 0));
          }
        } catch (_) {}
      }, 1500);
    }

    btnStart.addEventListener('click', start);
    btnStop.addEventListener('click', stop);
    document.getElementById('btnProxyFetch').addEventListener('click', proxyFetch);

    // Auto-save on change
    [domain, gtagId, maxPages, duration, hpm, maxConcurrent, outputDir, exportFormat, scrollStrategy, keywords, proxyHost, proxyPort, proxyUser, proxyPass, checkerWorkers].forEach(el => {
      if (el) el.addEventListener('change', saveToStorage);
    });
    [canvasFingerprint, sendScrollEvent, useSitemap, usePublicProxy, sitemapHomepageWeight].forEach(el => {
      if (el) el.addEventListener('change', saveToStorage);
    });

    loadConfig().then(() => {
      connectWebSocket();
      fetch('/api/status').then(r => r.json()).then(applyStatusData).catch(() => {});
    });
  </script>
</body>
</html>
